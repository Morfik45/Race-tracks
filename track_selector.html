<!DOCTYPE html>
<html>
<head>
  <title>Track Selector</title>
  <style>
    body {
      background: transparent;
      color: white;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      overflow: hidden;
    }

    #trackMenu {
      display: none;
      position: fixed;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.95);
      border: 2px solid lightgreen;
      padding: 20px;
      border-radius: 10px;
      z-index: 1001;
      width: 300px;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    }

    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1000;
    }

    #trackPreview {
      background: #111;
      border: 1px solid lightgreen;
      height: 140px;
      margin-bottom: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: gray;
    }

    #trackList {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 10px;
    }

    #trackList button {
      display: block;
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      background: transparent;
      border: 1px solid lightgreen;
      color: white;
      cursor: pointer;
    }

    #trackList button:hover {
      background: rgba(144, 238, 144, 0.1);
    }

    #confirmTrackBtn {
      padding: 8px 12px;
      border: 1px solid lightgreen;
      background: transparent;
      color: white;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
    }
  </style>
</head>
<body>

  <!-- Background Overlay -->
  <div id="overlay"></div>

  <!-- Track Selector Menu -->
  <div id="trackMenu">
    <h3 style="text-align: center; margin-bottom: 10px;">Select a Track</h3>

    <div id="trackPreview">Track preview will go here</div>

    <div id="trackList">
      <button 
        data-url="https://morfik45.github.io/Race-tracks/roxwood_circuit_drift.html"
        data-img="Images/drift_roxwood.png">
        Roxwood Circuit Drift
      </button>
    </div>

    <button id="confirmTrackBtn">Confirm</button>
  </div>

  <script>
    const trackMenu = document.getElementById("trackMenu");
    const confirmTrackBtn = document.getElementById("confirmTrackBtn");
    const preview = document.getElementById("trackPreview");
    const trackButtons = document.querySelectorAll("#trackList button");
    const overlay = document.getElementById("overlay");

    let selectedTrackUrl = null;
    let selectedButton = null;

    // Track selection logic
    trackButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        if (selectedButton) {
          selectedButton.style.backgroundColor = "transparent";
        }

        selectedTrackUrl = btn.getAttribute("data-url");
        selectedButton = btn;
        btn.style.backgroundColor = "rgba(144, 238, 144, 0.3)";

        const img = btn.getAttribute("data-img");
        preview.innerHTML = img
          ? `<img src="${img}" style="max-width: 100%; max-height: 100%; object-fit: cover;">`
          : "<em>No preview available</em>";
      });
    });

    // Load selected track
    confirmTrackBtn.onclick = () => {
      if (selectedTrackUrl) {
        location.href = selectedTrackUrl;
      }
    };

    // Close menu if overlay clicked
    overlay.onclick = () => hideTrackMenu();

    // ESC to close
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && trackMenu.style.display !== "none") {
        hideTrackMenu();
      }
    });

    function showTrackMenu() {
      trackMenu.style.display = "block";
      overlay.style.display = "block";
    }

    function hideTrackMenu() {
      trackMenu.style.display = "none";
      overlay.style.display = "none";
    }

    // Wait until iframe is visible and focused
    function waitUntilVisible() {
      let checks = 0;
      const check = setInterval(() => {
        if (document.hasFocus()) {
          showTrackMenu();
          clearInterval(check);
        }
        if (++checks > 10) clearInterval(check); // Stop after 10 tries
      }, 300);
    }

    // Start checking when loaded
    window.onload = waitUntilVisible;
  </script>

</body>
</html>
